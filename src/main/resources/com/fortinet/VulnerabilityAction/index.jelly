<?jelly escape-by-default='true'?>
<j:jelly xmlns:j="jelly:core" xmlns:l="/lib/layout" xmlns:st="jelly:stapler" xmlns:f="/lib/form">
    <l:layout title="Vulnerability">
        <l:side-panel>
            <st:include page="sidepanel.jelly" it="${it.run}" optional="true" />
        </l:side-panel>
        <l:main-panel>
        <f:section title="${%Image Vulnerability Summary}">
            <table class="pane">
                <tr>
                  <td class="pane-header" style="width:15em">${%Image Name}</td>
                  <td class="pane-header" style="width:15em">${%Risk Score}</td>
                  <td class="pane-header" style="width:15em">${%Critical}</td>
                  <td class="pane-header" style="width:15em">${%High}</td>
                  <td class="pane-header" style="width:15em">${%Medium}</td>
                  <td class="pane-header" style="width:15em">${%Low}</td>
                  <td class="pane-header" style="width:15em">${%Detail}</td>
                </tr>
                    <tbody>
                        <j:forEach var="image" items="${it.imageDtoList}">
                            <j:set var="imageDetailMap" value="${it.getVulnerSummaryReport(image)}"/>
                                <tr>
                                    <td class="pane">${image.imageName}</td>
                                    <td class="pane" style="text-align:left"><j:out value="${image.riskScore}"/></td>
                                    <td class="pane" style="text-align:left"><j:out value="${imageDetailMap.CRITICAL}"/></td>
                                    <td class="pane" style="text-align:left"><j:out value="${imageDetailMap.HIGH}"/></td>
                                    <td class="pane" style="text-align:left"><j:out value="${imageDetailMap.MEDIUM}"/></td>
                                    <td class="pane" style="text-align:left"><j:out value="${imageDetailMap.LOW}"/></td>
                                    <td class="pane no-wrap" style="text-align:left">
                                    <a href="${it.getImageVulnerabilityAddress()}${image.imageId}">Detail</a></td>
                              </tr>
                        </j:forEach>
                    </tbody>
              </table>
        </f:section>

        <st:nbsp/>
        <f:section title="${%Policy Alert Detail}">
             <table class="pane sortable bigtable stripped">
                 <tr>
                   <td class="pane-header" style="width:15em">${%Policy Name}</td>
                   <td class="pane-header" style="width:15em">${%View Detail}</td>
                 </tr>
                 <tbody>
                   <j:forEach var="alert" items="${it.alertDtoResult}">
                       <tr>
                         <td class="pane no-wrap" style="text-align:left">${alert.policyName}</td>
                         <td class="pane no-wrap" style="text-align:left">
                            <a href="${it.getPolicyCicdAddress()}">Policy Detail</a>
                         </td>
                       </tr>
                   </j:forEach>
                 </tbody>
               </table>
          </f:section>
        </l:main-panel>
    </l:layout>
</j:jelly>